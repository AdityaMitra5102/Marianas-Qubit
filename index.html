<!DOCTYPE html>
<html>
<head>
  <title>Connection Status</title>
</head>
<body>
  <!-- Hidden probe image -->
  <img src="http://local.mariana/favicon.ico" style="display:none"
       onload="console.log('Device is online!')"
       onerror="console.log('Device is offline or unreachable.')">

  <div id="status">Not connected</div>

  <script>
    async function checkConnections() {
      let status = [];

      // Check local client via fetch (allowed)
      try {
        const localResponse = await fetch(`http://localhost:8000/active?cacheBust=${Date.now()}`);
        const localText = await localResponse.text();
        if (localText.trim() === 'true') {
          status.push('Connected via local client');
        }
      } catch (e) {
        // Local connection failed, do nothing
      }

      // Check external client via <img> probe
      const img = new Image();
      img.onload = () => {
        status.push('Connected via external client');
        updateStatus();
      };
      img.onerror = () => {
        updateStatus();
      };
      img.src = `http://10.55.0.1/favicon.ico?cacheBust=${Date.now()}`;

      // Fallback timeout to update UI if image request hangs
      const timeout = setTimeout(updateStatus, 2000);

      function updateStatus() {
        clearTimeout(timeout);
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = status.length > 0 ? status.join(', ') : 'Not connected';
      }
    }

    // Run immediately and then every 5 seconds
    checkConnections();
    setInterval(checkConnections, 5000);
  </script>
</body>
</html>
